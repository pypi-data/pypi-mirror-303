{"version":3,"file":"Index-Ddviu-lr.js","sources":["../../../annotatedimage/dist/Index.svelte"],"sourcesContent":["<script>import { onMount } from \"svelte\";\nimport {\n  Block,\n  BlockLabel,\n  Empty,\n  IconButton,\n  IconButtonWrapper\n} from \"@gradio/atoms\";\nimport { Image, Maximize, Minimize } from \"@gradio/icons\";\nimport { StatusTracker } from \"@gradio/statustracker\";\nimport {} from \"@gradio/client\";\nimport { resolve_wasm_src } from \"@gradio/wasm/svelte\";\nexport let elem_id = \"\";\nexport let elem_classes = [];\nexport let visible = true;\nexport let value = null;\nlet old_value = null;\nlet _value = null;\nexport let gradio;\nexport let label = gradio.i18n(\"annotated_image.annotated_image\");\nexport let show_label = true;\nexport let show_legend = true;\nexport let height;\nexport let width;\nexport let color_map;\nexport let container = true;\nexport let scale = null;\nexport let min_width = void 0;\nlet active = null;\nexport let loading_status;\nexport let show_fullscreen_button = true;\nlet is_full_screen = false;\nlet image_container;\nonMount(() => {\n  document.addEventListener(\"fullscreenchange\", () => {\n    is_full_screen = !!document.fullscreenElement;\n  });\n});\nconst toggle_full_screen = async () => {\n  if (!is_full_screen) {\n    await image_container.requestFullscreen();\n  } else {\n    await document.exitFullscreen();\n  }\n};\nlet latest_promise = null;\n$: {\n  if (value !== old_value) {\n    old_value = value;\n    gradio.dispatch(\"change\");\n  }\n  if (value) {\n    const normalized_value = {\n      image: value.image,\n      annotations: value.annotations.map((ann) => ({\n        image: ann.image,\n        label: ann.label\n      }))\n    };\n    _value = normalized_value;\n    const image_url_promise = resolve_wasm_src(normalized_value.image.url);\n    const annotation_urls_promise = Promise.all(\n      normalized_value.annotations.map(\n        (ann) => resolve_wasm_src(ann.image.url)\n      )\n    );\n    const current_promise = Promise.all([\n      image_url_promise,\n      annotation_urls_promise\n    ]);\n    latest_promise = current_promise;\n    current_promise.then(([image_url, annotation_urls]) => {\n      if (latest_promise !== current_promise) {\n        return;\n      }\n      const async_resolved_value = {\n        image: {\n          ...normalized_value.image,\n          url: image_url ?? void 0\n        },\n        annotations: normalized_value.annotations.map((ann, i) => ({\n          ...ann,\n          image: {\n            ...ann.image,\n            url: annotation_urls[i] ?? void 0\n          }\n        }))\n      };\n      _value = async_resolved_value;\n    });\n  } else {\n    _value = null;\n  }\n}\nfunction handle_mouseover(_label) {\n  active = _label;\n}\nfunction handle_mouseout() {\n  active = null;\n}\nfunction handle_click(i, value2) {\n  gradio.dispatch(\"select\", {\n    value: label,\n    index: i\n  });\n}\n</script>\n\n<Block\n\t{visible}\n\t{elem_id}\n\t{elem_classes}\n\tpadding={false}\n\t{height}\n\t{width}\n\tallow_overflow={false}\n\t{container}\n\t{scale}\n\t{min_width}\n>\n\t<StatusTracker\n\t\tautoscroll={gradio.autoscroll}\n\t\ti18n={gradio.i18n}\n\t\t{...loading_status}\n\t/>\n\t<BlockLabel\n\t\t{show_label}\n\t\tIcon={Image}\n\t\tlabel={label || gradio.i18n(\"image.image\")}\n\t/>\n\n\t<div class=\"container\">\n\t\t{#if _value == null}\n\t\t\t<Empty size=\"large\" unpadded_box={true}><Image /></Empty>\n\t\t{:else}\n\t\t\t<div class=\"image-container\" bind:this={image_container}>\n\t\t\t\t<IconButtonWrapper>\n\t\t\t\t\t{#if !is_full_screen && show_fullscreen_button}\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tIcon={Maximize}\n\t\t\t\t\t\t\tlabel=\"View in full screen\"\n\t\t\t\t\t\t\ton:click={toggle_full_screen}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if is_full_screen}\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tIcon={Minimize}\n\t\t\t\t\t\t\tlabel=\"Exit full screen\"\n\t\t\t\t\t\t\ton:click={toggle_full_screen}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</IconButtonWrapper>\n\n\t\t\t\t<img\n\t\t\t\t\tclass=\"base-image\"\n\t\t\t\t\tclass:fit-height={height && !is_full_screen}\n\t\t\t\t\tsrc={_value ? _value.image.url : null}\n\t\t\t\t\talt=\"the base file that is annotated\"\n\t\t\t\t/>\n\t\t\t\t{#each _value ? _value?.annotations : [] as ann, i}\n\t\t\t\t\t<img\n\t\t\t\t\t\talt=\"segmentation mask identifying {label} within the uploaded file\"\n\t\t\t\t\t\tclass=\"mask fit-height\"\n\t\t\t\t\t\tclass:fit-height={!is_full_screen}\n\t\t\t\t\t\tclass:active={active == ann.label}\n\t\t\t\t\t\tclass:inactive={active != ann.label && active != null}\n\t\t\t\t\t\tsrc={ann.image.url}\n\t\t\t\t\t\tstyle={color_map && ann.label in color_map\n\t\t\t\t\t\t\t? null\n\t\t\t\t\t\t\t: `filter: hue-rotate(${Math.round(\n\t\t\t\t\t\t\t\t\t(i * 360) / _value?.annotations.length\n\t\t\t\t\t\t\t\t)}deg);`}\n\t\t\t\t\t/>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t\t{#if show_legend && _value}\n\t\t\t\t<div class=\"legend\">\n\t\t\t\t\t{#each _value.annotations as ann, i}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"legend-item\"\n\t\t\t\t\t\t\tstyle=\"background-color: {color_map && ann.label in color_map\n\t\t\t\t\t\t\t\t? color_map[ann.label] + '88'\n\t\t\t\t\t\t\t\t: `hsla(${Math.round(\n\t\t\t\t\t\t\t\t\t\t(i * 360) / _value.annotations.length\n\t\t\t\t\t\t\t\t\t)}, 100%, 50%, 0.3)`}\"\n\t\t\t\t\t\t\ton:mouseover={() => handle_mouseover(ann.label)}\n\t\t\t\t\t\t\ton:focus={() => handle_mouseover(ann.label)}\n\t\t\t\t\t\t\ton:mouseout={() => handle_mouseout()}\n\t\t\t\t\t\t\ton:blur={() => handle_mouseout()}\n\t\t\t\t\t\t\ton:click={() => handle_click(i, ann.label)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ann.label}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n</Block>\n\n<style>\n\t.base-image {\n\t\tdisplay: block;\n\t\twidth: 100%;\n\t\theight: auto;\n\t}\n\t.container {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\t.image-container {\n\t\tposition: relative;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tflex-grow: 1;\n\t\twidth: 100%;\n\t\toverflow: hidden;\n\t}\n\t.fit-height {\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tobject-fit: contain;\n\t}\n\t.mask {\n\t\topacity: 0.85;\n\t\ttransition: all 0.2s ease-in-out;\n\t\tposition: absolute;\n\t}\n\t.image-container:hover .mask {\n\t\topacity: 0.3;\n\t}\n\t.mask.active {\n\t\topacity: 1;\n\t}\n\t.mask.inactive {\n\t\topacity: 0;\n\t}\n\t.legend {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;\n\t\talign-content: center;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tgap: var(--spacing-sm);\n\t\tpadding: var(--spacing-sm);\n\t}\n\t.legend-item {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\tborder-radius: var(--radius-sm);\n\t\tpadding: var(--spacing-sm);\n\t}\n</style>\n"],"names":["ctx","i","if_block","create_if_block_1","src_url_equal","img","img_src_value","attr","toggle_class","insert","target","div","anchor","append","current","dirty","Maximize","Minimize","if_block0","create_if_block_3","create_if_block_2","img_style_value","each_value","ensure_array_like","t0_value","set_style","button","set_data","t0","Image","blocklabel_changes","elem_id","$$props","elem_classes","visible","value","old_value","_value","gradio","label","show_label","show_legend","height","width","color_map","container","scale","min_width","active","loading_status","show_fullscreen_button","is_full_screen","image_container","onMount","toggle_full_screen","latest_promise","handle_mouseover","_label","$$invalidate","handle_mouseout","handle_click","value2","$$value","ann","click_handler","normalized_value","image_url_promise","resolve_wasm_src","annotation_urls_promise","current_promise","image_url","annotation_urls","async_resolved_value"],"mappings":"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"}