"use strict";(self.webpackChunkrsp_jupyter_extensions=self.webpackChunkrsp_jupyter_extensions||[]).push([[360],{360:(e,o,t)=>{t.r(o),t.d(o,{default:()=>w});var n=t(837),s=t(623),r=t(957),i=t(492),a=t(182),l=t(29),u=t(83);function c(e){return l.createElement(n.TextItem,{source:`${e.source}`,title:`${e.title}`})}class g extends u.VDomRenderer{constructor(e){super(new u.VDomModel),this.props=e}render(){return this.props?l.createElement(c,{source:this.props.source,title:this.props.title}):null}dispose(){super.dispose()}}const d=g,p="rsp-jupyterlab",m=`${p}:plugin`,v=`${p}:displayversion`;n.IStatusBar;var h,b,f=t(882);!function(e){e.rubinquery="rubinquery"}(h||(h={}));class y extends f.Widget{constructor(){super({node:b.createQueryNode()}),this.addClass("rubin-qh")}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}s.IMainMenu,r.IDocumentManager,function(e){e.createQueryNode=function(){const e=document.createElement("div"),o=document.createElement("label");o.textContent="Enter Query Value";const t=document.createElement("input");return e.appendChild(o),e.appendChild(t),e}}(b||(b={}));var E,S=t(697);function q(e,o,t,n){R();const s=Promise.resolve(function(e,o,t){const n=[];(0,S.each)(e.shell.widgets("main"),(e=>{if(e){const t=o.contextForWidget(e);t?(console.log("Saving context for widget:",{id:e.id}),n.push(t.save())):console.log("No context for widget:",{id:e.id})}})),console.log("Waiting for all save-document promises to resolve.");let s=Promise.resolve(1);return n&&(Promise.all(n),s=n[0]),s}(e,o));return s.then((o=>C(e,0,0,n))),s.catch((e=>{console.log("saveAll failed: ",e.message)})),console.log("Save and Quit complete."),s}function C(e,o,t,n){R();let s="/";return n&&(s="/logout"),Promise.resolve(function(e){const o=e.serviceManager.serverSettings,t=i.PageConfig.getBaseUrl()+"rubin/hub";return console.log("hubRequest: URL: ",t," | Settings:",o),a.ServerConnection.makeRequest(t,{method:"DELETE"},o)}(e).then((()=>{console.log("Quit complete.")})).then((()=>{window.location.replace(s)})))}function R(){const e={title:"Redirecting to landing page",body:"JupyterLab cleaning up and redirecting to landing page.",buttons:[u.Dialog.okButton({label:"Got it!"})]};return(0,u.showDialog)(e).then((()=>{console.log("Info dialog panel displayed")}))}!function(e){e.justQuit="justquit:justquit",e.saveQuit="savequit:savequit",e.saveLogout="savelogout:savelogout"}(E||(E={})),s.IMainMenu,r.IDocumentManager;const w={activate:function(e,o,t,n){console.log("rsp-lab-extension: loading..."),console.log("...activating displayversion extension..."),function(e,o){console.log("RSP DisplayVersion extension: loading...");const t=e.serviceManager;var n,s;(n=i.PageConfig.getBaseUrl()+"rubin/environment",s=t.serverSettings,a.ServerConnection.makeRequest(n,{method:"GET"},s).then((e=>200!==e.status?e.json().then((o=>{throw new a.ServerConnection.ResponseError(e,o.message)})):e.json()))).then((e=>{const t=e.IMAGE_DESCRIPTION||"",n=e.IMAGE_DIGEST,s=e.JUPYTER_IMAGE_SPEC,r=" "+new URL(e.EXTERNAL_INSTANCE_URL||"").hostname,i=e.CONTAINER_SIZE||"";let a="";a=""===i?" ("+e.CPU_LIMIT+" CPU, "+e.MEM_LIMIT+" B)":" "+i;let l="",u="";if(s){const e=s.split("/"),o=e[e.length-1],t=o.split("@");2===t.length?(l=" ["+t[1].substring(7,15)+"...]",u=" ("+t[0]+")"):u=" ("+o+")",""===l&&n&&(l=" ["+n.substring(0,8)+"...]")}const c=new d({source:t+l+u+a+r,title:t});o.registerStatusItem(v,{item:c,align:"left",rank:80,isActive:()=>!0})})),console.log("RSP DisplayVersion extension: ... loaded")}(e,n),console.log("...activated..."),console.log("...activating savequit extension..."),function(e,o,t){console.log("rsp-savequit: loading...");e.serviceManager;const{commands:n}=e;n.addCommand(E.justQuit,{label:"Exit Without Saving",caption:"Destroy container",execute:()=>{C(e,0,0,!1)}}),n.addCommand(E.saveQuit,{label:"Save All and Exit",caption:"Save open notebooks and destroy container",execute:()=>{q(e,t,0,!1)}}),n.addCommand(E.saveLogout,{label:"Save All, Exit, and Log Out",caption:"Save open notebooks, destroy container, and log out",execute:()=>{q(e,t,0,!0)}});const s=[{command:E.justQuit},{command:E.saveQuit},{command:E.saveLogout}];o.fileMenu.addGroup(s,150),console.log("rsp-savequit: ...loaded.")}(e,o,t),console.log("...activated..."),console.log("...activating query extension..."),function(e,o,t){console.log("rsp-query...loading");const n=e.serviceManager,{commands:s}=e;s.addCommand(h.rubinquery,{label:"Open from portal query URL...",caption:"Open notebook from supplied portal query URL",execute:()=>{!function(e,o,t){(function(e){const o={title:"Query Value",body:new y,focusNodeSelector:"input",buttons:[u.Dialog.cancelButton(),u.Dialog.okButton({label:"CREATE"})]};return(0,u.showDialog)(o).then((e=>e?(console.log("Result from queryDialog: ",e),e.value?"CREATE"===e.button.label?(console.log("Got result ",e.value," from queryDialog: CREATE"),Promise.resolve(e.value)):(console.log("Did not get queryDialog: CREATE"),new Promise(((e,o)=>{}))):(console.log("No result.value from queryDialog"),new Promise(((e,o)=>{})))):(console.log("No result from queryDialog"),new Promise(((e,o)=>{})))))})().then((e=>{if(console.log("Query URL is",e),!e)return console.log("Query URL was null"),new Promise(((e,o)=>{}));const n=JSON.stringify({type:"portal",value:e});return function(e,o,t){const n=a.ServerConnection.makeSettings({baseUrl:t.baseUrl,appUrl:t.appUrl,wsUrl:t.wsUrl,init:t.init,token:t.token,Request:t.Request,Headers:t.Headers,WebSocket:t.WebSocket});return a.ServerConnection.makeRequest(e,o,n).then((e=>200!==e.status?e.json().then((o=>{throw new a.ServerConnection.ResponseError(e,o.message)})):e.json()))}(i.PageConfig.getBaseUrl()+"rubin/query",{method:"POST",body:n},t.serverSettings).then((e=>{const t=e.path;o.open(t)})),new Promise(((e,o)=>{}))}))}(0,t,n)}});const r={command:h.rubinquery},l=new f.Menu({commands:s});l.title.label="Rubin",l.insertItem(0,r),o.addMenu(l),console.log("rsp-query...loaded")}(e,o,t),console.log("...activated..."),console.log("...loaded rsp-lab-extension.")},id:m,requires:[s.IMainMenu,r.IDocumentManager,n.IStatusBar],autoStart:!0}}}]);