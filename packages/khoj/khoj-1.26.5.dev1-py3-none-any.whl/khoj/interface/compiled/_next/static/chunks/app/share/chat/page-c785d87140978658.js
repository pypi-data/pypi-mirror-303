(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3111],{91955:function(e,t,s){Promise.resolve().then(s.bind(s,5506))},5506:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var o=s(57437),a=s(11930),n=s.n(a),i=s(2265),r=s(48861),c=s(82697),l=s(58485);s(7395);var d=s(69591),h=s(79306),u=s(59479),m=s(9557);function p(e){let[t,s]=(0,i.useState)(""),[a,r]=(0,i.useState)(null),[l,d]=(0,i.useState)(!1),[h,m]=(0,i.useState)(null),p=e.setQueryToProcess,g=e.streamedMessages,f=e.isMobileWidth?"w-full":"w-4/6";return((0,i.useEffect)(()=>{a&&e.setImage64(encodeURIComponent(a))},[a,e.setImage64]),(0,i.useEffect)(()=>{t&&(d(!0),p(t))},[t,p]),(0,i.useEffect)(()=>{g&&g.length>0&&g[g.length-1].completed?d(!1):s("")},[g]),e.publicConversationSlug||e.conversationId)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:n().chatBodyFull,children:(0,o.jsx)(c.Z,{publicConversationSlug:e.publicConversationSlug,conversationId:e.conversationId||"",setAgent:m,setTitle:e.setTitle,pendingMessage:l?t:"",incomingMessages:e.streamedMessages,customClassName:f})}),(0,o.jsx)("div",{className:"".concat(n().inputBox," p-1 md:px-2 shadow-md bg-background align-middle items-center justify-center dark:bg-neutral-700 dark:border-0 dark:shadow-sm rounded-t-2xl rounded-b-none md:rounded-xl h-fit ").concat(f," mr-auto ml-auto"),children:(0,o.jsx)(u.Z,{isLoggedIn:e.isLoggedIn,sendMessage:e=>s(e),sendImage:e=>r(e),sendDisabled:l,chatOptionsData:e.chatOptionsData,conversationId:e.conversationId,agentColor:null==h?void 0:h.color,isMobileWidth:e.isMobileWidth,setUploadedFiles:e.setUploadedFiles})})]}):(0,o.jsx)("div",{className:n().suggestions,children:"Whoops, nothing to see here!"})}function g(){let[e,t]=(0,i.useState)(null),[s,a]=(0,i.useState)(!0),[c,u]=(0,i.useState)("Khoj AI - Chat"),[g,f]=(0,i.useState)(void 0),[x,_]=(0,i.useState)([]),[v,y]=(0,i.useState)(""),[b,C]=(0,i.useState)(!1),[j,w]=(0,i.useState)([]),[S,I]=(0,i.useState)(void 0),[B,N]=(0,i.useState)(""),O=(0,d.k6)()||{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},k=(0,h.GW)(),T=(0,d.IC)();async function D(e){if(!e.ok)throw Error(e.statusText);if(!e.body)throw Error("Response body is null");let t=e.body.getReader(),s=new TextDecoder,o="␃\uD83D\uDD1A␗",a="";for(;;){let e;let{done:n,value:i}=await t.read();if(n){y(""),C(!1),N("");break}for(a+=s.decode(i,{stream:!0});-1!==(e=a.indexOf(o));){let t=a.slice(0,e);if(a=a.slice(e+o.length),t){let e=x.find(e=>!e.completed);if(!e){console.error("No current message found");return}(0,m.VK)(t,e),_([...x])}}}}async function E(){if(!v||!g)return;let e={q:v,conversation_id:g,stream:!0,...O&&{region:O.region,country:O.country,city:O.city,country_code:O.countryCode,timezone:O.timezone},...B&&{image:B}},t=await fetch("/api/chat?client=web",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});try{await D(t)}catch(e){console.error(e)}}return((0,i.useEffect)(()=>{fetch("/api/chat/options").then(e=>e.json()).then(e=>{a(!1),e&&t(e)}).catch(e=>{console.error(e)}),(0,d.EK)(),I(window.location.pathname.split("/").pop()||"")},[]),(0,i.useEffect)(()=>{if(v&&!g){fetch("/api/chat/share/fork?public_conversation_slug=".concat(S),{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{f(e.conversation_id)}).catch(e=>{console.error(e)});return}if(v){let e={rawResponse:"",trainOfThought:[],context:[],onlineContext:{},completed:!1,timestamp:new Date().toISOString(),rawQuery:v||"",uploadedImageData:decodeURIComponent(B)};_(t=>[...t,e]),C(!0)}},[v,g,S]),(0,i.useEffect)(()=>{b&&E()},[b]),s)?(0,o.jsx)(l.Z,{}):S?(0,o.jsxs)("div",{className:"".concat(n().main," ").concat(n().chatLayout),children:[(0,o.jsx)("title",{children:c}),(0,o.jsx)("div",{className:n().sidePanel,children:(0,o.jsx)(r.ZP,{conversationId:null!=g?g:null,uploadedFiles:j,isMobileWidth:T})}),(0,o.jsx)("div",{className:n().chatBox,children:(0,o.jsxs)("div",{className:n().chatBoxBody,children:[!T&&c&&(0,o.jsx)("div",{className:"".concat(n().chatTitleWrapper," text-nowrap text-ellipsis overflow-hidden max-w-screen-md grid items-top font-bold mr-8 pt-6 col-auto h-fit"),children:c&&(0,o.jsx)("h2",{className:"text-lg text-ellipsis whitespace-nowrap overflow-x-hidden",children:c})}),(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)(l.Z,{}),children:(0,o.jsx)(p,{conversationId:g,streamedMessages:x,setQueryToProcess:y,isLoggedIn:null!==k,publicConversationSlug:S,chatOptionsData:e,setTitle:u,setUploadedFiles:w,isMobileWidth:T,setImage64:N})})]})})]}):(0,o.jsx)("div",{className:n().suggestions,children:"Whoops, nothing to see here!"})}},11930:function(e){e.exports={main:"sharedChat_main__7Nayy",suggestions:"sharedChat_suggestions__V8kr_",inputBox:"sharedChat_inputBox__wRW5A",chatBodyFull:"sharedChat_chatBodyFull__O1MOv",chatBody:"sharedChat_chatBody__OnHDL",chatLayout:"sharedChat_chatLayout__gutlc",chatBox:"sharedChat_chatBox__PmAPg",titleBar:"sharedChat_titleBar__vOHp_",chatBoxBody:"sharedChat_chatBoxBody__ef2Nl",agentIndicator:"sharedChat_agentIndicator__ORCl4"}}},function(e){e.O(0,[7849,8918,929,3954,9001,3062,8840,121,3110,6327,1603,9417,3423,9479,2697,2971,7023,1744],function(){return e(e.s=91955)}),_N_E=e.O()}]);