<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ specification.filename }}</title>
  <link href="https://unpkg.com/@gitlab/ui/dist/index.css" rel="stylesheet" />
  <script src="https://unpkg.com/@gitlab/ui"></script>
  <style>
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Noto Sans', 'Ubuntu', 'Droid Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.5;
      color: #2e2e2e;
      background-color: #fafafa;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background-color: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      padding: 16px;
      flex: 1 1 calc(20% - 20px);
      min-width: 280px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    }

    .stat-card h3 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
      color: #666;
    }

    .stat-card p {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
      color: #1f75cb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      background-color: #fff;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    }

    th,
    td {
      text-align: left;
      padding: 12px;
      border-bottom: 1px solid #e5e5e5;
      vertical-align: top;
    }

    th.right,
    td.right {
      text-align: right;
      padding: 12px;
      border-bottom: 1px solid #e5e5e5;
    }

    th {
      background-color: #fafafa;
      font-weight: 600;
      color: #666;
    }

    .card {
      background-color: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success {
      background-color: #108548;
      color: #fff;
    }

    .badge-warning {
      background-color: #ab6100;
      color: #fff;
    }

    .badge-danger {
      background-color: #dd2b0e;
      color: #fff;
    }

    .status {
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      display: inline-block;
    }

    .Passed {
      background-color: green;
    }

    .Failed {
      background-color: red;
    }

    .Error {
      background-color: red;
    }

    .Warning {
      background-color: orange;
    }

    .sub-info {
      font-size: 12px;
      color: #888;
    }

    .model-highlight {
      background-color: #e0f7e0;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: monospace;
    }

    .small-text {
      font-size: 12px;
    }

    tr[onclick] {
      cursor: pointer;
    }

    .sourceRow {
      display: none;
      background-color: #f9f9f9;
    }

    prompt {
      font-family: monospace;
      font-size: small;
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="header">
      <h1 class="gl-font-size-h1 gl-mb-5">Test Report: {{specification.filename}}</h1>
      <div class="logo">
        <svg width="48px" height="48px" viewBox="0 0 264 241" version="1.1" xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink">
          <title>Logo-design</title>
          <desc>Created with Sketch.</desc>
          <g id="Page-1" stroke="none" stroke-width="1" fill="#14285A" fill-rule="evenodd">
            <g id="PromptCraft-Logo" transform="translate(-27.000000, -28.000000)" fill="%2314285A">
              <g id="Logo-design" transform="translate(27.000000, 27.000000)">
                <g id="Logo"
                  transform="translate(132.000000, 121.100000) scale(-1, 1) rotate(-180.000000) translate(-132.000000, -121.100000) translate(0.000000, 0.600000)">
                  <path
                    d="M75.4,238.6 C36.8,229.7 8.5,200.8 1.3,163.1 C-1,151.4 1.38777878e-17,132.9 3.5,121.1 C10.8,95.9 24.6,78.8 55.3,56.8 C80.4,38.8 86.5,36.3 94.9,40.6 C98.2,42.2 124.9,69.1 125.8,71.7 C126,72.2 125.5,72.6 124.8,72.6 C121.9,72.6 107.1,80.6 95,88.6 C78.3,99.8 61.8,116 56.9,126.1 C53.6,132.9 53.5,133.5 53.5,145.1 C53.5,156.3 53.7,157.5 56.3,162.6 C57.9,165.6 60.8,170.1 62.9,172.6 C66.5,176.9 66.7,177.4 67.4,187 L68.1,196.8 L63.1,192.7 C60.4,190.4 55.8,186 53,182.9 C40.7,169.5 37,160.5 37,144.4 C37,125.9 43,113.4 60,96.6 C68.3,88.3 74,83.9 86.7,75.6 C95.6,69.8 102.9,64.8 102.9,64.4 C103,63.4 92.9,52.6 91.9,52.6 C90.6,52.6 79.1,59.9 67.6,68.1 C55.6,76.6 38.8,92.7 33,101.5 C23.3,116 19.7,128.1 19.7,146.1 C19.7,159.8 21.2,167 26.6,178.3 C40.1,206.5 68.2,222.1 102.3,220.3 C111.8,219.8 121.5,217.9 128.8,215.1 C129.7,214.8 126.9,211 120.8,204.4 C106.5,188.7 104.3,186.8 92.7,180.9 C75.5,172.1 74.8,170.4 75.2,139.6 L75.5,118.1 L90.5,138.1 C104.1,156.2 108.3,160.9 134.6,187.3 C161.8,214.5 164.1,216.6 169.1,218 C172,218.9 177.4,219.6 181.1,219.6 C194,219.6 205.1,214.4 219.9,201.5 C223.9,198 229,193.5 231.3,191.6 L235.3,188.2 L234.8,197.3 C234.4,204.7 233.7,207.7 231.3,212.8 C223.8,228.9 203.8,239.9 182,240 C171,240.1 161.2,237.6 151.7,232.2 L144.4,228 L136.6,231.9 C124.4,237.9 115.9,239.8 98.5,240.2 C86.4,240.5 81.9,240.2 75.4,238.6 Z"
                    id="Path"></path>
                  <path
                    d="M175.8,200.4 C173.3,198.6 165.1,191.2 157.6,184 L144,170.9 L146.7,169.5 C151.9,166.8 168.5,153.9 181.2,142.7 C209.9,117.5 213.3,110.2 212.8,75.8 C212.6,65.3 212.8,56.6 213.2,56.6 C214.5,56.6 221,66.5 224.2,73.2 C227.4,79.9 227.5,80.5 227.5,93.1 C227.5,104.2 227.1,107.1 225.1,112.9 C220.4,126.7 208.1,141.3 184.2,161.4 C177.8,166.9 171.5,172.5 170.2,173.8 L167.9,176.3 L172.5,182 C175,185.1 177.5,187.6 177.9,187.6 C178.3,187.6 184.9,182.6 192.6,176.5 C220,154.6 234.5,137.8 240.8,120.3 C248.4,99.4 247,79.2 236.7,59.1 C231.9,49.7 219.1,36.3 209.6,30.7 C195.7,22.4 177.8,18.6 162.1,20.5 C152.4,21.7 136.7,26.2 137.2,27.6 C137.4,28 142.6,33.1 148.8,38.9 C158.1,47.6 161.8,50.4 169.7,54.3 C175,56.9 181.1,60.9 183.4,63.1 C190.5,70 191,71.8 191,93.5 C191,104 190.6,112.6 190.2,112.6 C189.8,112.6 184.3,106.6 178,99.4 C171.8,92.1 153.9,73.5 138.3,58 C107.5,27.4 104.1,24.8 91.8,22.5 C75.2,19.4 56.6,28 37.5,47.5 C34.8,50.3 32.2,52.6 31.8,52.6 C31.4,52.6 31,49.8 31,46.3 C31,20.5 53.6,1.7 84.5,1.6 C95.6,1.6 103.1,3.4 113.2,8.5 L121,12.4 L127.5,8.9 C131,7 138.3,4.3 143.7,2.9 C157.3,-0.7 178.2,-0.9 191.4,2.4 C227,11.3 255.3,40.1 262.7,75.1 C264.8,85.2 264,108.5 261.1,118.6 C258.2,128.7 251.2,142.6 245.1,150.7 C238,160 224.8,172.3 208.4,184.8 C194.8,195.1 182.4,203.6 181,203.6 C180.7,203.6 178.3,202.1 175.8,200.4 Z"
                    id="Path"></path>
                  <path
                    d="M132.5,146.9 C123.9,145 117.5,140.4 113.7,133.2 C110.7,127.4 110.7,115.8 113.7,110.1 C120.1,98 135.1,93.2 147.6,99 C155.1,102.5 160.6,110.6 161.6,119.4 C162.7,128.9 155.7,140.7 146.6,144.6 C142.1,146.5 135.6,147.6 132.5,146.9 Z"
                    id="Path"></path>
                </g>
              </g>
            </g>
          </g>
        </svg>
      </div>
    </div>
    <p class="sub-info">Creation Date: {{date_created}}<br />Test Files: {{specification.metadata.test_path}}</p>

    <div class="stats-container">
      <div class="stat-card">
        <h3>Total Prompt Duration</h3>
        <p>{{ total_prompt_duration | round }} sec</p>
      </div>
      <div class="stat-card">
        <h3>Total Prompt Cost</h3>
        <p>${{ total_prompt_costs | round }}</p>
      </div>
      <div class="stat-card">
        <h3>Total Test Duration</h3>
        <p>{{ total_test_duration | round }} sec</p>
      </div>
      <div class="stat-card">
        <h3>Total Test Cost</h3>
        <p>${{ total_test_costs | round }}</p>
      </div>
      <div class="stat-card">
        <h3>Errors</h3>
        <p>{{ total_errors }}</p>
      </div>
      <div class="stat-card">
        <h3>Warnings</h3>
        <p>{{ total_warnings }}</p>
      </div>
    </div>

    <h2 class="gl-font-size-h2 gl-mb-3">Test Results</h2>

    {% for test in tests %}

    <h3>{{ test.test_id }}</h3>
    </p>
    <table>
      {% if test.specification.type == "question" %}
      <caption class="small-text">Model (completion): <span class="model-highlight">{{ specification.metadata.model
          }}</span>,
        {{specification.metadata.system_role}}</caption>
      {% endif %}
      <thead>
        <tr>
          <th>Status</th>
          <th>Input File</th>
          <th>Response</th>
          <th class="right">Prompt Duration</th>
          <th class="right">Prompt Cost</th>
          <th class="right">Test Duration</th>
          <th class="right">Test Costs</th>
        </tr>
      </thead>
      <tbody>
        {% for test_outcome in test.outcomes %}
        <tr>
          <td><span class="status {{test_outcome.status | value | lowercase }}">{{ test_outcome.status | value }}</span>
          </td>
          <td>{{ test_outcome.input_sample.filename }}</td>
          <td>
            {% if test_outcome.score %}
            Score: {{ test_outcome.score }}
            {% endif %}
            {{ test_outcome.response }}
          </td>
          <td>{{ test_outcome.prompt_duration | round }}</td>
          <td>{{ test_outcome.prompt_costs | round }}</td>
          <td>{{ test_outcome.test_duration | round }}</td>
          <td>{{ test_outcome.test_costs | round }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% endfor %}


    <h2 class="gl-font-size-h2 gl-mb-3">Errors and Warnings</h2>
    <div class="card">
      {% if total_errors == 0 and total_warnings == 0 %}
      <p>No errors or warnings found.</p>
      {% else %}
      <ul>
        {% for message in messages %}
        <li class="badge {{ message.level | lowercase }}">{{ message.level }}: {{ message.message }}</li>
        {% endfor %}
      </ul>
      {% endif %}
    </div>

    <h2 class="gl-font-size-h2 gl-mb-3">System Role</h2>
    <div class="card">
      <prompt>
        <p>{{ specification.metadata.system_role }}</p>
      </prompt>
    </div>

    <h2 class="gl-font-size-h2 gl-mb-3">Engineered Prompt</h2>
    <div class="card">
      <prompt>
        {{ specification.prompt }}
    </div>
    </prompt>
  </div>

  <script>
    function toggleSource(id) {
      var source = document.getElementById(id);
      if (source.style.display === 'none' || source.style.display === '') {
        source.style.display = 'table-row'; // Set it explicitly to table-row
      } else {
        source.style.display = 'none'; // Hide it
      }
    }
  </script>

</body>

</html>
