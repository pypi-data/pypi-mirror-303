# This file was generated by the OpenDapi CLI - `opendapi init`
# Please add, remove and update the integrations and their overrides as needed.
# For more information on the OpenDapi configuration schema, please visit:
# https://opendapi.org or talk to https://wovencollab.com

schema: https://opendapi.org/spec/0-0-1/opendapi.config.json

organization:
  name: {{ org_name }}
  email_domain: {{ org_email_domain }}

repository:
  urn: {{ org_name_snakecase }}.{{ repo_name }}
  mainline_branch: {{ mainline_branch_name }}

dapis:
  integrations:
    {%- if include_activerecord %}
    - type: activerecord
      applications:
        # Automatically include all rails applications with schema.rb files
        include_all: true

        # Rails Application specific overrides - Uncomment overrides stanza
        # if you'd like to configure a specific application
        # such as point to a different schema file
        # or add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        # overrides:
        #   - application_path: /path/to/rails_app
        #     schema_rb_path: db/schema.rb
        #
        #     # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
        #     model_allowlist: []
        #
        #     playbooks:
        #       # automatically add source and sink datastoress
        #       - type: add_source_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.postgres
        #         namespace: ~
        #         identifier_prefix: production_
        #
        #       - type: add_sink_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
        #         namespace: production_db.my_schema
        #         identifier_prefix: ~
        #
        #       - type: add_owner_team
        #         team_urn: {{ org_name_snakecase }}.teams.engineering
        #         model_allowlist: []

    {%- endif %}
    {%- if include_dbt %}
    - type: dbt
      projects:
        # Automatically include all applications with dbt_project.yml file
        include_all: true

        # DBT Project specific override - Uncomment overrides stanza
        # if you'd like to configure a specific project
        # such as point to a different artifacts directory
        # or add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        # overrides:
        #   - project_path: /path/to/dbt_project
        #     # Directory where the dbt artifacts such as manifest.json, and catalog.json are stored
        #     artifacts_dir: target
        #
        #     # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
        #     model_allowlist: []
        #
        #     playbooks:
        #       # automatically add source and sink datastoress
        #       - type: add_source_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
        #         namespace: production_database.production_schema
        #         identifier_prefix: ~
        #
        #       - type: add_owner_team
        #         team_urn: {{ org_name_snakecase }}.teams.engineering
        #         model_allowlist: []

        #     # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
        #     model_allowlist: []

    {%- endif %}
    {%- if include_pynamodb %}
    - type: pynamodb
      services:
        # Automatic addition not supported for PynamoDB
        include_all: false

        # Pynamodb Python services specific overrides
        # These are required to point to the correct base model classes
        # and optionally, add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        overrides:
          - service_path: /path/to/pynamodb_app

            # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
            model_allowlist: []

            # Manually install the opendapi library to this service.
            is_opendapi_lib_installed: false
            base_model_classes:
              - my_service.models.BaseModel
              - my_service.models.OtherBaseModel

            playbooks:
              - type: add_source_datastore
                datastore_urn: {{ org_name_snakecase }}.datastores.dynamodb
                namespace: ~
                identifier_prefix: production_

              - type: add_sink_datastore
                datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
                namespace: production_db.my_schema
                identifier_prefix: dynamodb_

              - type: add_owner_team
                team_urn: {{ org_name_snakecase }}.teams.engineering
                model_allowlist: []

    {%- endif %}
    {%- if include_sqlalchemy %}
    - type: sqlalchemy
      services:
        # Automatic addition not supported for SqlAlchemy
        include_all: false
        # SQLAlchemy service specific overrides
        # These are required to point to the correct base model classes
        # and optionally, add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        overrides:
          - service_path: /path/to/sqlalchemy_app

            # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
            model_allowlist: []

            # Manually install the opendapi library to this service.
            is_opendapi_lib_installed: false
            metadata_objects:
              - my_service.models.metadata_1
              - my_service.models.other_metadata

            playbooks:
              - type: add_source_datastore
                datastore_urn: {{ org_name_snakecase }}.datastores.postgres
                namespace: ~
                identifier_prefix: production_

              - type: add_sink_datastore
                datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
                namespace: production_db.my_schema
                identifier_prefix: ~

              - type: add_owner_team
                team_urn: {{ org_name_snakecase }}.teams.engineering
                model_allowlist: []

    {%- endif %}
    {%- if include_sequelize %}
    - type: sequelize
      packages:
        # Automatically include all javascripts packages with package.json files
        include_all: true

        # JS package specific overrides - Uncomment overrides stanza
        # if you'd like to configure a specific package
        # or add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        # overrides:
        #   - package_path: /path/to/package
        #
        #     # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
        #     model_allowlist: []
        #
        #     playbooks:
        #       # automatically add source and sink datastoress
        #       - type: add_source_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.postgres
        #         namespace: ~
        #         identifier_prefix: production_
        #
        #       - type: add_sink_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
        #         namespace: production_db.my_schema
        #         identifier_prefix: ~
        #
        #       - type: add_owner_team
        #         team_urn: {{ org_name_snakecase }}.teams.engineering
        #         model_allowlist: []

    {%- endif %}
    {%- if include_typeorm %}
    - type: typeorm
      packages:
        # Automatically include all Typescript packages with package.json files
        include_all: true

        # TS package specific overrides - Uncomment overrides stanza
        # if you'd like to configure a specific package
        # or add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        # overrides:
        #   - package_path: /path/to/package
        #
        #     # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
        #     model_allowlist: []
        #
        #     playbooks:
        #       # automatically add source and sink datastoress
        #       - type: add_source_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.postgres
        #         namespace: ~
        #         identifier_prefix: production_
        #
        #       - type: add_sink_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
        #         namespace: production_db.my_schema
        #         identifier_prefix: ~
        #
        #       - type: add_owner_team
        #         team_urn: {{ org_name_snakecase }}.teams.engineering
        #         model_allowlist: []

    {%- endif %}
    {%- if include_prisma %}
    - type: prisma
      applications:
        # Automatically include all schema.prisma files
        include_all: true

        # Prisma specific overrides - Uncomment overrides stanza
        # if you'd like to configure a specific application
        # such as point to a different schema file
        # or add patterns to identify source and sink datastores
        # or add model allowlist (regex) to include only specific models

        # overrides:
        #   - application_path: /path/to/app
        #     schema_path: schema.prisma
        #
        #     # add regex to include only specific models - e.g. model_allowlist: ['^accounts_.*', 'business']
        #     model_allowlist: []
        #
        #     playbooks:
        #       # automatically add source and sink datastoress
        #       - type: add_source_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.postgres
        #         namespace: ~
        #         identifier_prefix: production_
        #
        #       - type: add_sink_datastore
        #         datastore_urn: {{ org_name_snakecase }}.datastores.snowflake
        #         namespace: production_db.my_schema
        #         identifier_prefix: ~
        #
        #       - type: add_owner_team
        #         team_urn: {{ org_name_snakecase }}.teams.engineering
        #         model_allowlist: []

    {%- endif %}
